# 原创
：  39-3 Web应用防火墙 - WAF层绕过

# 39-3 Web应用防火墙 - WAF层绕过

#### 绕过WAF层

在设计WAF时，性能是一个重要考量因素。基于数据包的检测通常会考虑数据包的长度，而基于数据流的检测则会关注数据流的溢出情况。为了确保WAF的性能，通常会实施绕过设计。当性能指标如CPU利用率超过80%或内存使用率超过80%时，会执行绕过检测，以确保设备的正常运行。

WAF及类似设备均在应用层之上工作，例如HTTP、FTP、SMTP等协议都属于应用层。这些数据在处理前会经过数据解析和协议分析，最终提取应用层数据，例如HTTP方法、用户代理和请求体内容等。然后，将这些值与WAF设计的规则进行匹配，当匹配成功时执行相应的处理。

**绕过WAF的设计考虑**

1.  检测范围 WAF在处理HTTP POST上传大型文件时，检测的范围和资源消耗是关键因素。由于检测整个数据流可能导致高CPU和内存使用率，WAF通常会设置一个默认检测范围，决定要处理多少字节的数据或多少个数据包。 
1.  通过填充数据绕过 为了测试WAF的绕过潜在漏洞，研究者会使用填充数据来进行测试。例如，通过不断增加HTTP POST请求中的填充数据，直到WAF无法检测到恶意代码。这样可以评估WAF在处理大型文件或高流量时的检测能力。 
1.  绕过检测 这种测试方法可以帮助发现WAF的弱点，并提供可能绕过其检测的策略。例如，通过超出WAF的检测范围或填充足够多的数据，可能达到绕过WAF的目的。研究者可能通过这样的方式验证WAF的安全性和可靠性。 

#### 性能负载导致绕过的情况

1.  传统硬件防护设备可能在高负载时为了避免影响用户
