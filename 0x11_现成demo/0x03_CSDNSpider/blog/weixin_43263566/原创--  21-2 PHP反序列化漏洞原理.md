# 原创
：  21-2 PHP反序列化漏洞原理

# 21-2 PHP反序列化漏洞原理

#### 1、原理:

序列化与反序列化是保证数据一致性的过程。

#### 2、产生:

序列化与反序列化的过程中，用户可控

如果反序列化的参数受到攻击者的控制，就会产生漏洞。攻击者可以通过修改参数个数等方式来控制反序列化过程，从而导致代码执行、SQL注入、目录遍历等不可控后果。如果在反序列化过程中没有对用户输入的序列化字符串进行检测，就会导致安全漏洞。

#### 3、触发:

unserialize()函数参数可控: 漏洞的触发点在于调用了unserialize()函数，并且该函数的参数是可被用户控制的。攻击者可以通过操纵序列化字符串中的数据来控制反序列化的过程，从而导致漏洞的触发。

PHP中存在可利用的类，且类中有魔术方法: 漏洞的触发还依赖于PHP中存在可利用的类，并且该类中实现了魔术方法。攻击者可以通过构造特定的序列化字符串来触发目标类中的魔术方法，进而执行恶意代码或者产生其他不可预期的行为。

#### 4、魔术方法

PHP中以双下划线为前缀开头的方法，统称为魔术方法。这些方法都是系统预定义的特殊方法，在类或对象发生某个事件之前或之后，会自动调用这些方法，无需手动进行调用。如果希望根据自己的程序定制特殊功能的类，就需要对这些方法进行重写。

常见的魔术方法包括:
