# 原创
：  web安全-数据包参数内容简介-文件上传WAF(安全狗)绕过方法

# web安全-数据包参数内容简介-文件上传WAF(安全狗)绕过方法

## 一、上传参数名解析：明确哪些东西能修改
1. 打开upload-labs的靶场的第二关。1. 上传文件抓取数据包。1. 简介：1. 总结：
## 二、文件上传实验
1. 将抓取到的数据包里文件名的后缀改为php后点击上传，发现其被安全狗拦截了，并没有成功上传。1. 在安全狗里可以看到其存在如下保护，对文后缀名存在限制。1. 对此情况的绕过方法有两种。1. 这里尝试加了个空格。1. 发现可以成功上传上去，但是其无法执行，依然是一个图片。1. 后面尝试根据文件名的明明规则，在文件名末尾加点或者空格，结构均被拦截了。
## 三、数据溢出绕过-防匹配(xxx.. .)
1. 如果数据量特别多，程序就可能匹配到哪里就截止了，或者程序崩了，就可能成功上传上去。1. 因为其检测的是filename，所以采用数据溢出绕过时就其值修改的特别长。1. 可以看到最开始时候安全狗依然还在拦截，但是当文件名达到一定长度后，发现放包之后久久没有抓到返回的数据包。1. 此时查看服务器，发现弹出了下面的页面，Apache的服务直接崩掉了，但是此时文件依然没有上穿上去。1. 重启服务。1. 想到因为其是从前到后慢慢检测，所以考虑将垃圾数据添加到前面，但是发现还是被拦截了。1. 那就尝试继续添加，并在下图所示位置添加一个分号，在不断的尝试下，某一时刻发现返回页面并没有被拦截。1. 查看文件夹，发现成功上传了。1. 尝试换一个地方插入垃圾数据。1. 发现依然成功上传了。
## 四、符号变异绕过-防匹配（'" ;)
1. 抓取数据包后查看下图所示部分，1. 尝试在其后面添加分号以后添加其它内容，发现还是被拦截了。1. 将filename参数值两侧的双引号改为单引号，发现还是被拦截了。1. 尝试将filename参数值后面的引号去掉后上传，发现上传成功了。1. 将filename的值改为有前没有后的单引号进行上传，发现上传也成功了。1. 将filename的值两侧的引号全部去掉，发现上传也成功了。1. 至此更加证明了我们的猜想，安全狗只匹配单引号或者双引号里的内容。1. 但是！当我们将前面的双引号去掉，保存后面的双引号时，发现依然是被安全狗给拦截了。1. 此时对安全狗的猜想变成了，其会将最后一个单引号或者双引号的值取出来，然后对其前面的值进行检测。1. 因此我们进行以下实验，将后缀名.php放到引号的外面，发现真的成功上传了，并且上传的文件可以当作php执行。1. 如果在引号外面添加完整文件名，尝试上传，发现上传依然成功了。
## 五、数据截断绕过-防匹配(; / 换行)
1. 尝试将filename的值改为下图内容，发现成功绕过了。1. 将filename的值进行换行操作，发现依然上传成功了。1. 在引号后面添加一个“/”后上传，发现成功上传了。
## 六、重复数据绕过-防匹配(参数多次)
1. 在后面添加一个分号之后添加一个“Y.jpg”，来验证其是以哪个名字为准。1. 放包后查看发现其文件名是“Y.jpg”，因此推测其是以后面的文件名为准。1. 那么我们想到能否像前面的垃圾数据一样在其前面多添加一些垃圾数据后上传。1. 发现此方法可行。1. 将前面的内容像如图所示一样插入到filename参数值里进行上传，发现上传成功了。