# 原创
：  Java反序列化漏洞及实例详解

# Java反序列化漏洞及实例详解

**目录**

[一、序列化和反序列化](#%E4%B8%80%E3%80%81%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96)

[序列化](#%E5%BA%8F%E5%88%97%E5%8C%96)

[用途](#%E7%94%A8%E9%80%94)

[二、Java反序列化漏洞](#%E4%BA%8C%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E)

[数据出现](#%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0)

[函数接口](#%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3)

[漏洞发现](#%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0)

[漏洞利用](#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8)

[三、Java序列化反序列化演示](#%E4%BA%8C%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E)

[四、靶场演示](#%E4%BA%8C%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E)

---


## 一、序列化和反序列化

### 序列化

        把 Java 对象转换为字节序列（字节流）的过程。

**反序列化**

        把字节序列（字节流）恢复为 Java 对象的过程。

### 用途

## 二、Java反序列化漏洞

### **数据出现**

### **函数接口**

### **漏洞发现**

**1、黑盒分析：**

**        **数据库出现地---观察数据特性。

**2、白盒分析：**

**        **组件安全&amp;函数搜索&amp;功能模块。

### 漏洞利用

        Ysoserial集成的jar包配合生成，特性的专业漏洞利用工具等。

## 三、Java序列化反序列化演示

**&lt;第一部分&gt;**

2.执行序列化部分的代码，可以看到在指定路径下生成了指定的文件，文件内包含序列化的内容。

3.使用工具对序列化内容进行查看，可以看到其头部内容为ACED。

4.执行反序列化部分的代码，可以看到其反序列化成功，并且将原始的内容进行了返回。

5.至此，我们可以想到，如果将反序列化的目标文件的内容进行修改，修改成具有攻击性的代码，那么就可以实现一定的攻击性行为。

**&lt;第二部分&gt;**

1.这里用到一款工具，其支持一些pyload的生成。

2.打开工具。

3.后面为空的就是不需要其它的包，只需要java的原生类。

4. 先来到下面的网站获取一个地址。

5.在工具内执行下面的命令。

6.来到目标路径下可以看到生成的文件，以及文件内的序列化内容。

7. 使用工具产看，其头部内容为ACED。

8.将a.txt放到刚刚反序列化的目录下。 

9.将正常要进行反序列化的文件改成我们刚刚使用工具生成的文件。

10.执行序列化程序。

<img alt="" height="731" src="https://img-blog.csdnimg.cn/29947dd6597743beb54e6b5a3c9c45ca.png" width="1173"/>11.可以看到网站内成功获取到了数据。

12.这里发生了啥？

        在这里我们将其原有的代码数据更改成了一个访问http的代码数据，当对方在进行反序列化的时候，就会将我们更改后的代码数据进行执行，就会对http进行访问。

## 四、靶场演示

1.启动靶场。

2.进入靶场，选择对应关卡。

3. 可以看到给出的序列化代码是以rO0AB开头的，是 JAVA 序列化 base64 加密的数据。

4.使用工具生成pyload。

5.再来目录下可以看到生成的文件。

6.生成的内容如下。

<img alt="" height="557" src="https://img-blog.csdnimg.cn/9c948a5f6d3b428482d4412d4afe3307.png" width="1022"/>7.因为源代码会将序列化内容进行base64解密，因此我们还需要对其进行一次加密，使用下面的代码记性加密。 

8.加密后的内容如下。

9.将代码粘贴到靶场。

<img alt="" height="607" src="https://img-blog.csdnimg.cn/6b27383882744faf97bd480db125bd46.png" width="1200"/>10.点击提交后可以看到成功指定了调取计算器的命令。
