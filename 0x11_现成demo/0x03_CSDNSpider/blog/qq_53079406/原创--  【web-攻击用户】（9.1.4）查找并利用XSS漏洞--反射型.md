# 原创
：  【web-攻击用户】（9.1.4）查找并利用XSS漏洞--反射型

# 【web-攻击用户】（9.1.4）查找并利用XSS漏洞--反射型

**目录**

[查找并利用反射型XSS漏洞](#%E6%9F%A5%E6%89%BE%E5%B9%B6%E5%88%A9%E7%94%A8%E5%8F%8D%E5%B0%84%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E)

[2.5、避开基于签名的过滤](#2.5%E3%80%81%E9%81%BF%E5%BC%80%E5%9F%BA%E4%BA%8E%E7%AD%BE%E5%90%8D%E7%9A%84%E8%BF%87%E6%BB%A4)

[引入脚本代码的方法](#%E5%BC%95%E5%85%A5%E8%84%9A%E6%9C%AC%E4%BB%A3%E7%A0%81%E7%9A%84%E6%96%B9%E6%B3%95)

[脚本标签](#%E8%84%9A%E6%9C%AC%E6%A0%87%E7%AD%BE)

[脚本伪协议](#%E8%84%9A%E6%9C%AC%E4%BC%AA%E5%8D%8F%E8%AE%AE)

[2.6、避开过滤：HTML](#2.6%E3%80%81%E9%81%BF%E5%BC%80%E8%BF%87%E6%BB%A4%EF%BC%9AHTML)

[简述：](#%E7%AE%80%E8%BF%B0%EF%BC%9A)

[标签名称](#%E6%A0%87%E7%AD%BE%E5%90%8D%E7%A7%B0)

[标签名称后的空格](#%E6%A0%87%E7%AD%BE%E5%90%8D%E7%A7%B0%E5%90%8E%E7%9A%84%E7%A9%BA%E6%A0%BC)

[属性名称](#%E5%B1%9E%E6%80%A7%E5%90%8D%E7%A7%B0)

[属性分隔符](#%E5%B1%9E%E6%80%A7%E5%88%86%E9%9A%94%E7%AC%A6)

[属性值](#%E5%B1%9E%E6%80%A7%E5%80%BC)

[标签括号](#%E6%A0%87%E7%AD%BE%E6%8B%AC%E5%8F%B7)

[字符集](#%E5%AD%97%E7%AC%A6%E9%9B%86)

[2.7、避开过滤：脚本代码](#2.7%E3%80%81%E9%81%BF%E5%BC%80%E8%BF%87%E6%BB%A4%EF%BC%9A%E8%84%9A%E6%9C%AC%E4%BB%A3%E7%A0%81)

[简述：](#%E7%AE%80%E8%BF%B0%EF%BC%9A)

[使用JavaScript转义](#%E4%BD%BF%E7%94%A8JavaScript%E8%BD%AC%E4%B9%89)

[动态构建字符串](#%E5%8A%A8%E6%80%81%E6%9E%84%E5%BB%BA%E5%AD%97%E7%AC%A6%E4%B8%B2)

[替代eval的方法](#%E6%9B%BF%E4%BB%A3eval%E7%9A%84%E6%96%B9%E6%B3%95)

[替代圆点](#%E6%9B%BF%E4%BB%A3%E5%9C%86%E7%82%B9)

[组合多种技巧](#%E7%BB%84%E5%90%88%E5%A4%9A%E7%A7%8D%E6%8A%80%E5%B7%A7)

---


## 查找并利用反射型XSS漏洞

> 
<h3>2.5、避开基于签名的过滤</h3>
在第一种类型的过滤中， 应用程序通常会对攻击字符串做出与无害字符串截然不同的响应，如通过一条错误消息，甚至会指出发现一个可能的XSS攻击
如果出现这种情况，接下来应该确定输入中的哪些字符或表达式触发了过滤。一种有效的方法是轮流删除字符串的不同部分，看输入是否仍然被阻止。使用这种方法可迅速查明是否是某个特殊的表达式造成请求被阻止。如果确实如此， 那么需要避开过滤
有各种不同的方法可以在HTML页面中引入脚本代码， 这些方法通常能够避开基于签名的过滤。要么找到引入脚本的其他方法， 要么使用浏览器接受的略显畸形的语法
<hr/>
<h4>引入脚本代码的方法</h4>
有4种不同的方法可用于在HTML页面中引入脚本代码
浏览器对于各种HTML和脚本语法的支持各不相同。个体浏览器的行为也往往会随着新版本的发布而发生改变，任何针对个体浏览器行为的明确指南也很快会过时。但从安全的角度看， 应用程序需要在所有当前和最新版本的常用浏览器中可靠运行。
<hr/>
<h4>脚本标签</h4>
1、直接使用&lt;script&gt;标签
2、通过各种方法、使用复杂的语法来隐藏标签
事件处理器：事件处理器可与各种标签结合使用（触发事件）
<hr/>
<h4>脚本伪协议</h4>
脚本伪协议可用在各种位置（如在URL的属性中执行行内脚本，使用javascript伪协议）


---


#### 脚本标签

> 
<h3>2.6、避开过滤：HTML</h3>
<h4>简述：</h4>
对HTML请求进行模糊处理以避开常见的过滤
旨在阻止XSS攻击的基于签名的过滤通常采用正则表达式或其他技巧来确定关键的HTML组件， 如标签括号、标签名称、属性名称和属性值。如过滤器可能会阻止包含使用已知可用于引入脚本的特殊标签或属性名称的HTML的输入，或试图阻止以脚本伪协议开头的属性值。通过以一种或多种浏览器接受的方式在HTML中的关键位过插入不常见的字符、可以避开其中的许多过滤。
<hr/>
<h4>标签名称</h4>
1、改变所使用字符的大小写
2、在任何位置插入NULL字节（[%xx]）
［%xx]表示十六进制ASCII代码XX的原义字符。在向应用程序实施攻击时，通常会使用字符的URL编码形式。在查看应用程序的响应时， 需要在其中寻找已解码的原义字符
3、使用可替代的标签
4、基本标签劫持实施攻击。&lt;base&gt;标签用于指定一个URL，浏览器应使用该URL解析随后在页面中出现的任何相对URL。如果可以引入一个新的&lt;base&gt;，并且页面执行反射点后的任何使用相对URL的&lt;script&gt;， 则你就可以指定一个指向受你控制的服务器的基本URL。当浏览器加载在HTML页面的剩余部分指定的脚本时， 这些脚本将从指定的服务器加载， 但仍然能够在调用它们的页面中执行
<hr/>
<h4>标签名称后的空格</h4>
一些字符可用于替代标签名称与第一个属性名称之间的空格
即使在实施攻击时不需要任何标签属性， 仍然应始终在标签名称后面添加一些多余的内容， 因为这样做可以避开一些简单的过滤
<hr/>
<h4>属性名称</h4>
在属性名称中使用NULL字节（如on[%00]error）
<hr/>
<h4>属性分隔符</h4>
属性值之间并未分隔开来， 因而需要在属性值后面插入一些空格， 表示属性值已结束，以便于添加其他属性，属性可以选择使用双引号或单引号进行分隔
如果过滤器不知道重音符被用作属性分隔符（如&lt;img src=`a`οnerrοr=alert(1)&gt;）
在标签名称后面插入异常字符， 就可以设计出不需要使用任何空格的攻击， 从而避开一些简单的过滤
<hr/>
<h4>属性值</h4>
1、属性值中， 可以使用NULL
2、使用HTML编码的字符（在处理属性值之前， 浏览器会对其进行HTML解码，）
<hr/>
<h4>标签括号</h4>
1、双重编码（可能存在多余的双重URL解码）
2、特殊奇怪的形式（比如&lt;&lt;代替&lt;，用&gt;&gt;代替&gt;）
<hr/>
<h4>字符集</h4>
1、非标准编码方法（UTF-7、US-ASCII、UTF-16……）
如果应用程序默认使用多字节字符集，就可以通过提交在所采用的字符集中具有特殊意义的字符来避开某些输入过滤


#### 标签名称

---


#### 属性名称

---


#### 属性值

---


#### 字符集

> 
<h3>2.7、避开过滤：脚本代码</h3>
<h4>简述：</h4>
某些情况下， 可以找到办法来操纵反射型输入， 从而在应用程序的响应中插入脚本。但可能会遇到各种其他障碍， 无法执行实施有效攻击所需的代码。这时遇到的过滤通常会试图阻止你使用某些JavaScript关键字和其他表达式，还可能阻止有用的字符（如引号、括号和圆点）
<hr/>
<h4>使用JavaScript转义</h4>
1、JavaScript允许各种字符转义， 可以通过这种方式避免包含原义格式的表达式
2、Unicode转义可用于表示JavaScnpt关键字中的字符， 从而避开许多类型的过滤
3、如果能够使用eval命令（通过利用转义它的某些字符）， 就可以将其他命令以字符串格式传送给eval命令， 从而执行这些命令，就可以利用各种字符串操纵技巧来隐藏执行的命令
<hr/>
<h4>动态构建字符串</h4>
1、拼接起来（如'go'+'od'）
<hr/>
<h4>替代eval的方法</h4>
1、使用.replace(xxx,eval)
2、通过其他方法以字符串格式执行命令
<hr/>
<h4>替代圆点</h4>
1、如alert(document('cookie'))和with(document)alert(cookie)
<hr/>
<h4>组合多种技巧</h4>
1、如alert中的e字符使用Unicode转义方法进行了转义， 并且Unicode转义中使用的反斜线经过了HTML编码


#### 使用JavaScript转义

---


#### 替代eval的方法

---


#### 组合多种技巧
