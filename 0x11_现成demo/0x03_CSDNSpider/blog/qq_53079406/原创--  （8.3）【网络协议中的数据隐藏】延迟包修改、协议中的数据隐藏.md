# 原创
：  （8.3）【网络协议中的数据隐藏】延迟包修改、协议中的数据隐藏

# （8.3）【网络协议中的数据隐藏】延迟包修改、协议中的数据隐藏

**目录**

[一、延迟包修改方法](#%E4%B8%80%E3%80%81%E5%BB%B6%E8%BF%9F%E5%8C%85%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95)

[1.1、数据隐藏方法：](#1.1%E3%80%81%E6%95%B0%E6%8D%AE%E9%9A%90%E8%97%8F%E6%96%B9%E6%B3%95%EF%BC%9A)

[1.2、利用：](#1.2%E3%80%81%E5%88%A9%E7%94%A8%EF%BC%9A)

[1.3、优点：](#1.3%E3%80%81%E4%BC%98%E7%82%B9%EF%BC%9A)

[二、IP 层数据隐藏， TTL 字段](#%E4%BA%8C%E3%80%81IP%20%E5%B1%82%E6%95%B0%E6%8D%AE%E9%9A%90%E8%97%8F%EF%BC%8C%20TTL%20%E5%AD%97%E6%AE%B5)

[2.1、概述：](#2.1%E3%80%81%E6%A6%82%E8%BF%B0%EF%BC%9A)

[2.2、TTL字段：](#2.2%E3%80%81TTL%E5%AD%97%E6%AE%B5%EF%BC%9A)

[分析可行性：](#%E5%88%86%E6%9E%90%E5%8F%AF%E8%A1%8C%E6%80%A7%EF%BC%9A)

[利用：](#%E5%88%A9%E7%94%A8%EF%BC%9A)

[2.3、TTL字段隐藏数据：](#2.3%E3%80%81TTL%E5%AD%97%E6%AE%B5%E9%9A%90%E8%97%8F%E6%95%B0%E6%8D%AE%EF%BC%9A)

[示例](#%E7%A4%BA%E4%BE%8B)

[过程：](#%E8%BF%87%E7%A8%8B%EF%BC%9A)

[2.4、总结：](#2.4%E3%80%81%E6%80%BB%E7%BB%93%EF%BC%9A)

[三、协议中的数据隐藏分析](#%E4%B8%89%E3%80%81%E5%8D%8F%E8%AE%AE%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9A%90%E8%97%8F%E5%88%86%E6%9E%90)

[3.1、概述：](#3.1%E3%80%81%E6%A6%82%E8%BF%B0%EF%BC%9A)

[3.2、Wireshark](#1.2%E3%80%81Wireshark)

[简介：](#%E7%AE%80%E4%BB%8B%EF%BC%9A)

[下载（官网）：](#%E4%B8%8B%E8%BD%BD%EF%BC%88%E5%AE%98%E7%BD%91%EF%BC%89%EF%BC%9A)

[使用：](#%E4%BD%BF%E7%94%A8%EF%BC%9A)

---


## 一、延迟包修改方法

> 
<h3>1.1、数据隐藏方法：</h3>
这个方法充分利用了RTP包作为核心元素偶尔会发生延时、失序或者丢失的特性。


> 
<h3>1.2、利用：</h3>
（1）在发送数据流之前先系统地从数据流提取出特定数据包，故意让这些数据包不能按时发送到接收方。
（2）接收数据包的应用程序， 不管是VoIP还是音频播放器， 都会自动填充这些空白， 以补充延时的数据包。



RTP延迟包修改方法 


> 
<h3>1.3、优点：</h3>
因为大多数RTP报文都只包含几微秒的语音， 听语音对话甚至音乐流时很难察觉到其中有填充内容。
<hr/>
一旦将报文从数据流中提取出来， 数据隐藏应用程序就会在整个有效载荷区域中嵌入隐藏消息片段， 然后再把报文放回到数据流中（但是会有几秒钟的延迟） 。数据包到达目的地时（已有明显延迟）， 接收应用程序就会丢弃这些数据包，并永不使用， 因为延迟而导致的空白区域已经填充过了。然而，VoIP的侦听应用程序会识别并提取延迟包， 进而恢复有效载荷， 重构其中的原始秘密信息。



---


---


## 二、IP 层数据隐藏， TTL 字段

> 
<h3>2.1、概述：</h3>
OSI模型的每层协议几乎都有嵌入数据的可能
在这就选择IP包路由的主力(IP层）作为研究对象，IP数据包是UDP和TCP报文的主要组成部分
<hr/>
从标准IP报文头字段布局中， 可以看到IP报文头定义了20个字节,这20个字节没有可选值， 但都有各自的特殊用途
 eg：指定源地址和目标地址、定义服务类型、校验和或者下层协议。
还有个有趣的字段就是8 位(1个字节） 的TTL(T ime to live, 存活时间） 字段。

IP协议 


> 
<h3>2.2、TTL字段：</h3>
<h4>分析可行性：</h4>
因为IP是个很“尽最大努力” 的协议。也就是说，IP层会尽它的最大努力把报文发送到最终目的地， 因此就出现了所谓的报文生命周期机制，以便在报文无法送达目的地的情况下丢弃该报文。IP报文在路由器间穿梭， 不断寻找到达目的地的路径。它每经过一个路由器，TTL值就减1, 当TTL值变为0时， 就丢弃该报文。这个机制使IP报文不会持续循环传输， 进而造成网络拥塞。
<hr/>
如今， 网络路由十分智能， 大多数报文从源地址到达目的地址通常只需经过几跳。虽然尚无针对典型IP报文路由跳数的确切统计数据， 美国本土的网络流量中平均报文跳数为8 ~ 15, 比TTL允许的最大值255小得多， 因此除非目标不可达， 否则在报文到达目的地前几乎不可能耗尽生存时间(TTL)。
<hr/>
<h4>利用：</h4>
所以我们可以用TTL值的前两位来隐藏数据， 而不会影响报文传输。嵌入数据的报文格式如下， 我们将所有报文的默认TTL值定为3F（十六进制）， 即63跳， 剩余的前两位则用来嵌入隐藏数据。

 通过分割TTL字段来隐藏数据


---


#### 利用：

> 
<h3>2.3、TTL字段隐藏数据：</h3>
<h4>示例</h4>
用在IP流中隐藏单词“ HIDE” 
<hr/>
<h4>过程：</h4>
（1）将每个字符转换成十六进制的ASCII码值， 比如，H = 48。
（2）再转换成二进制， 每2位分成一组， 这些两位组将会分别嵌入到各个报文的TTL值的前两位中。
（3）TTL值的低6位值默认为3F, 即xxllllll。其中xx将被替换为两位组。替换完成后就形成了一个新的IP报文序列（共16个IP包）， 然后就可以传递隐藏信息"HIDE"了


TTL数据隐藏计划的详细信息 


#### 过程：

> 
<h3>2.4、总结：</h3>
通过这种方法发送1MB的隐藏文件可能会有些不可思议， 因为每个IP 报文只能嵌入1/4 个字节， 那么要隐藏1MB 的数据就需要大约4百万个报文。但是， 要知道流媒体传输过程需要大量的报文， 比如， 一小时的流媒体（音乐或视频流）传输， 你知道其中会有多少个IP 报文吗？


---


---


## 三、协议中的数据隐藏分析

> 
<h3>3.1、概述：</h3>
如果从调查取证的角度分析协议， 我们则需要使用网络协议分析工具或嗅探器， Wireshark 就是个不错的工具。如果你怀疑网络协议中嵌入了数据， 那么就可以用Wireshark 抓取两个通信实体间的RTP 报文。然后， 通过分析报文载荷区域的头部信息就可以检测到隐藏信息。这种方法听起来可能不太现实， 但实际上， Wireshark 还有很强大的搜索和过滤功能， 而且报文头格式是很规律的， 稍微花点功夫就可以检测到可疑的报文。
<hr/>
如果要检测延迟报文中的数据隐藏， 就需要先找到延迟报文的序列号， 将报文根据时间戳排序， 然后写一个简单的python 脚本来识别延迟超过几秒的报文。如果你很熟悉SNORT 或其他入侵检测工具， 可以采用一些策略和触发条件来持续监控网络通信， 进而发现异常行为。


> 
<h3>3.2、Wireshark</h3>
<h4>简介：</h4>
Wireshark（前称Ethereal）是一个网络封包分析软件。网络封包分析软件的功能是截取网络封包，并尽可能显示出最为详细的网络封包资料。Wireshark使用WinPCAP作为接口，直接与网卡进
<hr/>
<h4>下载（官网）：</h4>
[Wireshark · Go Deep.<img alt="" src="https://csdnimg.cn/release/blog_editor_html/release2.1.3/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=M4AD"/>https://www.wireshark.org/](https://www.wireshark.org/)
<hr/>
<h4>使用：</h4>

 <img alt="" height="788" src="https://img-blog.csdnimg.cn/341d9c68a0be4bab9144d0670211ad8d.png" width="1200"/>



#### 下载（官网）：

---

