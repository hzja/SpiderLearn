# 原创
：  【每日渗透笔记】文件上传绕过尝试

# 【每日渗透笔记】文件上传绕过尝试

**目录**

[一、特点：](#%E4%B8%80%E3%80%81%E7%89%B9%E7%82%B9%EF%BC%9A)

[1.1、特征：](#1.1%E3%80%81%E7%89%B9%E5%BE%81%EF%BC%9A)

[1.2、语言：](#1.2%E3%80%81%E8%AF%AD%E8%A8%80%EF%BC%9A)

[1.3、正常上传的数据包：](#1.3%E3%80%81%E6%AD%A3%E5%B8%B8%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85%EF%BC%9A)

[ 目前：](#%C2%A0%E7%9B%AE%E5%89%8D%EF%BC%9A)

[问题：](#%E9%97%AE%E9%A2%98%EF%BC%9A)

[二、判断](#%E4%BA%8C%E3%80%81%E5%88%A4%E6%96%AD)

[2.1、判断检测类型](#2.1%E3%80%81%E5%88%A4%E6%96%AD%E6%A3%80%E6%B5%8B%E7%B1%BB%E5%9E%8B)

[2.2、判断拦截工具](#2.2%E3%80%81%E5%88%A4%E6%96%AD%E6%8B%A6%E6%88%AA%E5%B7%A5%E5%85%B7)

[三、绕过](#%E4%B8%89%E3%80%81%E7%BB%95%E8%BF%87)

---


## 一、特点：

> 
<h3>1.1、特征：</h3>
文件上传功能点


> 
<h3>1.2、语言：</h3>
首先看见是java语言


### 1.3、正常上传的数据包：

> 
<h4> 目前：</h4>
手动测试：
1、发现会对 filename和Content-Type进检测
所以上传正常图片文件+木马代码
上传成功，且返回了文件路径

包含木马的图片
 <img alt="" height="665" src="https://img-blog.csdnimg.cn/659aa7e203c645fc811e7ecdfdb9e3e3.png" width="617"/>
2、上传的图片可以访问




> 
<h4>问题：</h4>
1、判断检测类型（黑名单、白名单）
黑名单可以尝试替换
aspx&amp;asp：ashx、asa、asmx、cer  
php： php3、phtml  
jsp：jspx、jspf
2、判断拦截工具
3、尝试绕过方法


---


---


## 二、判断

> 
<h3>2.1、判断检测类型</h3>
先假设是黑名单
上传一个不可能在黑名单里面的文件（例如tx）
上传失败，反之则可能是白名单了




> 
<h3>2.2、判断拦截工具</h3>
wafw00f 加上URL
显示没有waf，那就是代码检测了



---


---


## 三、绕过

> 
 1、垃圾数据+换行



> 
 2、 尝试java里面的注释符/**/和//
放在各种位置



> 
3、截断符%00，和0x00（16进制）
截断失败

无效文件名



> 
 4、参数混淆
 这里是filename参数（尝试加了很多，检测的是最后一个参数，失败）


> 
5、编码
尝试了URL、unicode……编码都失败


> 
6、在数据包中，再添加一个上传的文件，同时上传多个文件
两个完整的post数据
正常文件放在第二位置时，失败

 正常文件放在第一位置时，失败
（一次可能只能一个文件上传）


<hr/>
（1）、在一个上传post数据包里面
（正常文件名的放在木马文件下）
重复一个正常的
Content-Disposition: form-data; name="file"; filename1="7c68c546c165411899ea2f401d192b24.jpeg"<br/> Content-Type: image/jpeg
（还是检测第一个非正常的jsp文件）


（2）（正常文件名的放在木马文件上）


 <img alt="" height="232" src="https://img-blog.csdnimg.cn/9224aaef14954421b73a35142024ad43.png" width="1200"/>
也不行
（应该是只能上传一个） 


> 
 7、条件竞争
（不建议尝试）

