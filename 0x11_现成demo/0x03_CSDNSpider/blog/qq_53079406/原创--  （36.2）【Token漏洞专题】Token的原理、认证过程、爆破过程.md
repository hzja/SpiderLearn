# 原创
：  （36.2）【Token漏洞专题】Token的原理、认证过程、爆破过程

# （36.2）【Token漏洞专题】Token的原理、认证过程、爆破过程

**目录**

[一、介绍：](#%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D%EF%BC%9A)

[二、原理：](#%E4%BA%8C%E3%80%81%E5%8E%9F%E7%90%86%EF%BC%9A)

[三、身份认证过程：](#%E4%B8%89%E3%80%81%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B%EF%BC%9A)

[3.1、首次登录](#3.1%E3%80%81%E9%A6%96%E6%AC%A1%E7%99%BB%E5%BD%95)

[3.2、服务器验证](#3.2%E3%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%AA%8C%E8%AF%81)

[3.3、返回Token](#3.3%E3%80%81%E8%BF%94%E5%9B%9EToken)

[3.4、存在Token](#3.4%E3%80%81%E5%AD%98%E5%9C%A8Token)

[3.5、再次访问](#3.5%E3%80%81%E5%86%8D%E6%AC%A1%E8%AE%BF%E9%97%AE)

[3.6、验证](#3.6%E3%80%81%E9%AA%8C%E8%AF%81)

[四、Token爆破](#%E5%9B%9B%E3%80%81Token%E7%88%86%E7%A0%B4)

[4.1、前提：](#4.1%E3%80%81%E5%89%8D%E6%8F%90%EF%BC%9A)

[4.1.1、抓包](#4.1.1%E3%80%81%E6%8A%93%E5%8C%85)

[4.1.2、有效负载设置](#4.1.2%E3%80%81%E6%9C%89%E6%95%88%E8%B4%9F%E8%BD%BD%E8%AE%BE%E7%BD%AE)

[4.1.3、payload1设置](#4.1.3%E3%80%81payload1%E8%AE%BE%E7%BD%AE)

[4.1.4、payload2设置](#4.1.4%E3%80%81payload2%E8%AE%BE%E7%BD%AE)

[4.1.5、选项设置](#4.1.5%E3%80%81%E9%80%89%E9%A1%B9%E8%AE%BE%E7%BD%AE)

[4.1.6、结果分析：](#4.1.6%E3%80%81%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90%EF%BC%9A)

---


 （核心）

---


## 一、介绍：

> 
为了保护凭据的安全，为了减轻服务器的压力，减少频繁的查询数据库……采用了Token进行身份认证，一般会把token二次保存在cookie或session里面，并且根据cookie和session的过期时间去维护token的过期时间
Token的身份认证具有：安全、跨平台程序调用、无状态、可扩展、支持移动设备


---


## 二、原理：

> 
基于Token的身份验证是无状态的，我们不将用户信息存在服务器中。
当第一次登录后，服务器生成一个Token便将此Token返回给客户端，Token是服务端生成的一串字符串，并作为客户端请求的一个身份令牌，以后再登录，只需带上Token请求数据，不需要再次输入用户名和密码


---


## 三、身份认证过程：

> 
<h4>3.1、首次登录</h4>
用户通过用户名和密码发送请求。
<h4>3.2、服务器验证</h4>
后端服务器收到登录请求后，对用户名对应的密码进行查询并验证  
<h4>3.3、返回Token</h4>
（密码验证成功后）根据用户对应的userID等信息，生成一个与该用户绑定的Token（带标签），返回给客户端
<h4>3.4、存在Token</h4>
客户端将token存储到cookie等里面
<h4>3.5、再次访问</h4>
每次请求访问时候进行路由跳转，都携带包含Token的cookie到服务器端
<h4>3.6、验证</h4>
后端服务器验证Token的有效性，校验成功则返回请求数据（变为登录状态）；校验失败则返回错误码，并跳转到登录页面


#### 3.2、服务器验证

#### 3.4、存在Token

#### 3.6、验证

---


 

## 四、Token爆破

### 4.1、前提：

> 
如果服务器检测到频繁的错误登录后，并将该账户锁定，那么将无法再进行爆破


#### 4.1.1、抓包

> 
先使用burpsuite等工具进行抓包
并发送到Intruder（攻击/测试器）



#### 4.1.2、有效负载设置

> 
攻击类型设置为pichfork（叉）
如果对特定账号，就只需要对密码和Token进行爆破
如果批量账号，那么就对账号，密码，Token，一起进行爆破



#### 4.1.3、payload1设置

> 
我设置的有效载荷的位置1对应的是密码
设置为字典爆破  Runtime File
使用自己网上找的密码字典



#### 4.1.4、payload2设置

> 
 有效载荷的位置2为Token
设置为Recursive grep（递归搜索）
同时在Payload Options选中第一项，并将之前复制的token值输入到下面的输入栏中



#### 4.1.5、选项设置

> 
 先提前错误提示一下：
（我设置了递归和多线程的时候，出现了如下错误提示）
recursive grep payloads cannot be used with multiple request threads
递归Grep有效载荷不能与多个请求线程一起使用


**选项开始设置：**
设置线程数为1


设置递归搜索
在搜索字词中找到关键词Token的位置
然后将其值前面的字符串作为开始，后面的字符串作为结束
如果设置成功，那么，这个值将被包裹起来


 将最下面的重定向设置为总是<img alt="" height="980" src="https://img-blog.csdnimg.cn/5d81689ba9ae4c569d88e3689e1ad4c5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6buR6Imy5Zyw5bimKOW0m-i1tyk=,size_20,color_FFFFFF,t_70,g_se,x_16" width="1196"/>



 

 

#### 4.1.6、结果分析：

> 
可以使用过滤器进行筛选

 如果出现长度和其他不一样的，很长的就是正确的了


 
