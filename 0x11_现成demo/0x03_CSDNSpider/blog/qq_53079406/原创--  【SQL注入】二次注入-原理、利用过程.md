# 原创
：  【SQL注入】二次注入：原理、利用过程

# 【SQL注入】二次注入：原理、利用过程

**目录**

[一、二次注入](#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5)

[1.1、原理：](#%E5%8E%9F%E7%90%86%EF%BC%9A)

[1.2、发现：](#%E4%B8%8D%E5%90%8C%E7%82%B9%EF%BC%9A%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0)

[二、利用过程：](#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%9A)

[2.1、第一步：构造恶意语句](#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%9E%84%E9%80%A0%E6%81%B6%E6%84%8F%E8%AF%AD%E5%8F%A5)

[2.2、第二步：插入恶意数据](#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%8F%92%E5%85%A5%E6%81%B6%E6%84%8F%E6%95%B0%E6%8D%AE)

[2.3、第三步：二次构造语句，引用恶意数据](#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E7%AC%AC%E4%BA%8C%E6%AC%A1%E6%9E%84%E9%80%A0%E8%AF%AD%E5%8F%A5%EF%BC%8C%E5%BC%95%E7%94%A8%E6%81%B6%E6%84%8F%E6%95%B0%E6%8D%AE)

[三、示例：](#%E7%A4%BA%E4%BE%8B%EF%BC%9A)

[3.1、sqli-labs-master less-24](#sqli-labs-master%20less-24)

[第一步：构造一个带转义字符的语句](#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E6%9E%84%E9%80%A0%E4%B8%80%E4%B8%AA%E5%B8%A6%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6%E7%9A%84%E8%AF%AD%E5%8F%A5)

[第二步：通过注册新用户，将语句注入数据库](#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E9%80%9A%E8%BF%87%E6%B3%A8%E5%86%8C%E6%96%B0%E7%94%A8%E6%88%B7%EF%BC%8C%E5%B0%86%E8%AF%AD%E5%8F%A5%E6%B3%A8%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93)

[第三步：二次注入调用数据库中转义语句](#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5%E8%B0%83%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%BD%AC%E4%B9%89%E8%AF%AD%E5%8F%A5)

---


## 一、二次注入

> 
<h3>1.1、原理：</h3>
攻击者构造恶意的数据并存储在数据库后，恶意数据被读取并进入到SQL查询语句所导致的注入。防御者可能在用户输入恶意数据时对其中的特殊字符进行了转义处理，但在恶意数据插入到数据库时被处理的数据又被还原并存储在数据库中，当Web程序调用存储在数据库中的恶意数据并执行SQL查询时，就发生了SQL二次注入。
即输入恶意的数据库查询语句时会被转义，但在数据库调用读取语句时又被还原导致语句执行。
<hr/>

在二次注入中，一般不会是单纯的二次注入，通常还会与报错注入或Bool盲注结合。比如，在注册页面输入的用户名在登录后才有盲注的回显，这时候我们需要自己编写脚本模拟注册及登录。






> 
<h3>1.2、发现：</h3>
无法通过扫描工具或者手工测试出来，二次注入一般在审计代码过程中发现
从前端或黑盒测试无法看到


---


---


## 二、利用过程：

> 
<h3>2.1、第一步：构造恶意语句</h3>
语句含有被转义字符的恶意查询语句
<hr/>
<h3>2.2、第二步：插入恶意数据</h3>
进行数据库插入数据时，对其中特殊字符进行了转义处理，在写入数据库时保留了原来的数据。
<hr/>
<h3>2.3、第三步：二次构造语句，引用恶意数据</h3>
开发者默认存入数据库的数据都是安全的，在进行查询时，直接从数据库中取出构造的恶意数据，没有进行进一步的检验


### 2.2、第二步：插入恶意数据

---


---


---


## 三、示例：

> 
<h3>3.1、sqli-labs-master less-24</h3>
<h4>第一步：构造一个带转义字符的语句</h4>
注册账户：admin'#
密码：123456
<hr/>
<h4>第二步：通过注册新用户，将语句注入数据库</h4>

<hr/>
<h4>第三步：二次注入调用数据库中转义语句</h4>
登录进去后，此时更改admin'#密码
相当于：
update password=$new where username=admin'#
（admin后引号对前面的单引号进行了闭合，#注释掉了后面的语句，就相当于对admin进行了改密）


#### 第一步：构造一个带转义字符的语句

---


#### 第三步：二次注入调用数据库中转义语句
